# benchmark/config.yaml
#
# Common configuration for rJMX-Exporter benchmark
# This config is used by rJMX-Exporter to compare against jmx_exporter
#
# Both exporters should produce equivalent metrics with identical rules

# Jolokia endpoint configuration
jolokia:
  url: "http://java-app:8778/jolokia"
  timeout_ms: 5000

# HTTP server configuration (rJMX-Exporter)
server:
  port: 9090
  path: "/metrics"
  bind_address: "0.0.0.0"

# Metric transformation rules
# These rules are designed to match jmx_exporter's default JVM metrics
rules:
  # ============================================
  # JVM Memory Metrics
  # ============================================

  # Heap Memory
  - pattern: 'java.lang<type=Memory><HeapMemoryUsage>(\w+)'
    name: "jvm_memory_heap_$1_bytes"
    type: gauge
    help: "JVM heap memory usage"

  # Non-Heap Memory
  - pattern: 'java.lang<type=Memory><NonHeapMemoryUsage>(\w+)'
    name: "jvm_memory_nonheap_$1_bytes"
    type: gauge
    help: "JVM non-heap memory usage"

  # ============================================
  # JVM Threading Metrics
  # ============================================

  - pattern: 'java.lang<type=Threading><ThreadCount>'
    name: "jvm_threads_current"
    type: gauge
    help: "Current number of live threads"

  - pattern: 'java.lang<type=Threading><DaemonThreadCount>'
    name: "jvm_threads_daemon"
    type: gauge
    help: "Current number of daemon threads"

  - pattern: 'java.lang<type=Threading><PeakThreadCount>'
    name: "jvm_threads_peak"
    type: gauge
    help: "Peak number of threads"

  - pattern: 'java.lang<type=Threading><TotalStartedThreadCount>'
    name: "jvm_threads_started_total"
    type: counter
    help: "Total number of threads started"

  # ============================================
  # JVM Garbage Collection Metrics
  # ============================================

  - pattern: "java.lang<type=GarbageCollector,name=([^>]+)><CollectionCount>"
    name: "jvm_gc_collection_count"
    type: counter
    help: "JVM garbage collection count"
    labels:
      gc: "$1"

  - pattern: "java.lang<type=GarbageCollector,name=([^>]+)><CollectionTime>"
    name: "jvm_gc_collection_time_ms"
    type: counter
    help: "JVM garbage collection time in milliseconds"
    labels:
      gc: "$1"

  # ============================================
  # JVM Class Loading Metrics
  # ============================================

  - pattern: 'java.lang<type=ClassLoading><LoadedClassCount>'
    name: "jvm_classes_loaded"
    type: gauge
    help: "Number of classes currently loaded"

  - pattern: 'java.lang<type=ClassLoading><TotalLoadedClassCount>'
    name: "jvm_classes_loaded_total"
    type: counter
    help: "Total number of classes loaded since JVM start"

  - pattern: 'java.lang<type=ClassLoading><UnloadedClassCount>'
    name: "jvm_classes_unloaded_total"
    type: counter
    help: "Total number of classes unloaded since JVM start"

  # ============================================
  # JVM Runtime Metrics
  # ============================================

  - pattern: 'java.lang<type=Runtime><Uptime>'
    name: "jvm_uptime_ms"
    type: counter
    help: "JVM uptime in milliseconds"

  # ============================================
  # JVM Operating System Metrics
  # ============================================

  - pattern: 'java.lang<type=OperatingSystem><AvailableProcessors>'
    name: "jvm_os_available_processors"
    type: gauge
    help: "Number of processors available to the JVM"

  - pattern: 'java.lang<type=OperatingSystem><SystemLoadAverage>'
    name: "jvm_os_system_load_average"
    type: gauge
    help: "System load average for the last minute"
